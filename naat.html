<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Naat Collection - Ramadhan World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Listen to a beautiful collection of Naats praising the Prophet Muhammad Ô∑∫.">
    <link rel="canonical" href="https://www.ramadhanworld.com/naat.html">
    <!-- CSP-friendly meta tags -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.youtube.com https://s.ytimg.com https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; frame-src 'self' https://www.youtube.com https://www.youtube-nocookie.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https: http:; connect-src 'self' https://api.aladhan.com https://nominatim.openstreetmap.org;">
    
    <!-- Common Head Content (CSS, Fonts, etc.) -->
    <link rel="icon" href="https://i.ibb.co/Zp0bgjsS/ART-WORKS-1.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Amiri:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    body{font-family:'Cairo','Inter',sans-serif;background:linear-gradient(to bottom,#0a192f,#113a3b);color:#e6f1ff}
    .card{background-color:rgba(10,25,47,.85);backdrop-filter:blur(10px);border:1px solid rgba(57,255,20,.2);box-shadow:0 8px 32px 0 rgba(0,0,0,.37);border-radius:.75rem}
    .nav-button.active{background-color:#39FF14;color:#0a192f;font-weight:700;box-shadow:0 4px 14px rgba(57,255,20,.4)}
    .nav-button:hover{background-color:rgba(57,255,20,.8);color:#000}
    .video-container{position:relative;width:100%;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:.75rem;max-width:960px;margin:auto}
    .video-container iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:none}
    .ad-container-bottom{margin-top:1.5rem;padding-top:1.5rem;border-top:1px dashed rgba(57,255,20,.3);text-align:center}
    
    /* Enhanced fallback styles */
    .youtube-fallback {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
        width: 100%;
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        color: #e6f1ff;
        font-size: 1.1rem;
        text-align: center;
        padding: 40px 20px;
        box-sizing: border-box;
        border-radius: 0.75rem;
        border: 2px dashed rgba(57,255,20,.3);
    }
    
    .fallback-icon {
        font-size: 3rem;
        color: #39FF14;
        margin-bottom: 1rem;
    }
    
    .fallback-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #39FF14;
    }
    
    .fallback-message {
        margin-bottom: 1.5rem;
        line-height: 1.6;
        opacity: 0.9;
    }
    
    .retry-button {
        background-color: #39FF14;
        color: #0a192f;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 0.5rem;
    }
    
    .retry-button:hover {
        background-color: rgba(57,255,20,.8);
        transform: translateY(-2px);
    }
    
    .loading-spinner {
        border: 3px solid rgba(57,255,20,.3);
        border-top: 3px solid #39FF14;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .status-message {
        background-color: rgba(57,255,20,.1);
        border: 1px solid rgba(57,255,20,.3);
        padding: 12px;
        border-radius: 8px;
        margin: 10px 0;
        font-size: 0.9rem;
    }
    
    .error-details {
        background-color: rgba(255,0,0,.1);
        border: 1px solid rgba(255,0,0,.3);
        padding: 10px;
        border-radius: 6px;
        margin-top: 10px;
        font-size: 0.8rem;
        color: #ffcccc;
    }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div id="loading-screen" class="fixed inset-0 bg-gray-900 flex flex-col justify-center items-center z-50 transition-opacity duration-300">
        <h1 class="text-4xl sm:text-5xl font-extrabold" style="color: #39FF14;">RAMADHAN WORLD</h1>
    </div>

    <div id="main-content" class="min-h-screen container mx-auto p-4 sm:p-6 lg:p-8 opacity-0 transition-opacity duration-1000">
        <!-- Header Section -->
        <header class="text-center mb-6">
            <img id="app-logo" src="https://i.ibb.co/Zp0bgjsS/ART-WORKS-1.png" alt="Ramadhan World App Logo" class="w-[200px] h-[200px] mx-auto mb-4 rounded-full shadow-lg object-contain" loading="lazy" decoding="async">
            <h1 class="text-4xl sm:text-5xl font-extrabold" style="color: #39FF14;">Ramadhan World</h1>
            <p id="islamic-date" class="text-lg text-gray-300 mt-2">Loading Islamic Date...</p>
            <p id="location" class="text-md text-gray-400 mt-1">Fetching location...</p>
        </header>

        <!-- Navigation -->
        <nav class="flex justify-center gap-2 mb-6 flex-wrap items-center">
            <a href="index.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">üè† Home</a>
            <a href="salah.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">üïå Salah</a>
            <a href="quran.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">üìñ Quran</a>
            <a href="radio.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">üìª Radio</a>
            <a href="ask.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">üí¨ Ask Islam</a>
            <a href="tasbeeh.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">üìø Tasbeeh</a>
            <a href="hadith.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">üìú Hadith</a>
            <a href="naat.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">üéµ Naat</a>
            <a href="qibla.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">üß≠ Qibla</a>
            <a href="calendar.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">üóìÔ∏è Calendar</a>
            <a href="settings.html" class="nav-button px-4 py-2 rounded-lg bg-gray-700 transition">‚öôÔ∏è Settings</a>
        </nav>

        <!-- Main Content -->
        <main>
             <div class="card p-6 mx-auto text-center">
                <h2 class="text-2xl font-semibold mb-4">Naat Collection</h2>
                <div class="video-container mb-4">
                    <div id="youtube-player">
                        <!-- Enhanced fallback message -->
                        <div class="youtube-fallback" id="fallback-container">
                            <div class="fallback-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="fallback-title">Loading Naat Collection...</div>
                            <div class="loading-spinner"></div>
                            <div class="fallback-message">
                                Preparing your spiritual journey with beautiful Naats
                            </div>
                            <div id="status-messages"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Enhanced Controls -->
                <div class="flex justify-center gap-4 flex-wrap mb-4">
                    <button onclick="previousVideo()" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full text-lg transition-all duration-300" title="Previous Naat">
                        <i class="fas fa-backward"></i>
                    </button>
                    <button id="tv-play-button" onclick="playVideo()" class="text-black font-bold py-2 px-4 rounded-full text-lg transition-all duration-300" style="background-color: #39FF14;" title="Play">
                        <i class="fas fa-play"></i>
                    </button>
                    <button id="tv-pause-button" onclick="pauseVideo()" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full text-lg hidden transition-all duration-300" title="Pause">
                        <i class="fas fa-pause"></i>
                    </button>
                    <button onclick="nextVideo()" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full text-lg transition-all duration-300" title="Next Naat">
                        <i class="fas fa-forward"></i>
                    </button>
                </div>
                
                <!-- Additional Controls -->
                <div class="flex justify-center gap-2 flex-wrap">
                    <button onclick="retryPlayer()" class="retry-button" id="retry-btn" style="display: none;">
                        <i class="fas fa-redo"></i> Retry Loading
                    </button>
                    <button onclick="switchToNoCookie()" class="retry-button" id="nocookie-btn" style="display: none;">
                        <i class="fas fa-shield-alt"></i> Privacy Mode
                    </button>
                    <button onclick="openInNewTab()" class="retry-button" id="external-btn" style="display: none;">
                        <i class="fas fa-external-link-alt"></i> Open in YouTube
                    </button>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="text-center p-4 text-sm text-gray-600 space-x-4 mt-8">
          <a href="about.html" class="text-blue-600 underline">About</a>
          <a href="privacy.html" class="text-blue-600 underline">Privacy Policy</a>
          <a href="contact.html" class="text-blue-600 underline">Contact</a>
        </footer>
    </div>
    
    <script>
        // Global variables
        const loadingScreen = document.getElementById("loading-screen");
        const mainContent = document.getElementById("main-content");
        const islamicDateEl = document.getElementById("islamic-date");
        const locationEl = document.getElementById("location");
        const tvPlayButton = document.getElementById("tv-play-button");
        const tvPauseButton = document.getElementById("tv-pause-button");
        const fallbackContainer = document.getElementById("fallback-container");
        const statusMessages = document.getElementById("status-messages");
        const retryBtn = document.getElementById("retry-btn");
        const noCookieBtn = document.getElementById("nocookie-btn");
        const externalBtn = document.getElementById("external-btn");
        
        let youtubePlayer = null;
        let playerAttempts = 0;
        let maxAttempts = 3;
        let currentPlaylistId = "PL6b_3Yr67_wFpDJfaZLlMEUP6h5EroJi2";
        let useNoCookieVersion = false;
        let playerReady = false;
        
        // Enhanced status messaging
        function addStatusMessage(message, type = 'info') {
            const messageEl = document.createElement('div');
            messageEl.className = type === 'error' ? 'error-details' : 'status-message';
            messageEl.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i> ${message}`;
            statusMessages.appendChild(messageEl);
            
            // Auto-remove info messages after 5 seconds
            if (type === 'info') {
                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.remove();
                    }
                }, 5000);
            }
        }
        
        function clearStatusMessages() {
            statusMessages.innerHTML = '';
        }
        
        function updateFallbackUI(state, message = '') {
            const fallbackIcon = fallbackContainer.querySelector('.fallback-icon i');
            const fallbackTitle = fallbackContainer.querySelector('.fallback-title');
            const fallbackMessage = fallbackContainer.querySelector('.fallback-message');
            const loadingSpinner = fallbackContainer.querySelector('.loading-spinner');
            
            switch(state) {
                case 'loading':
                    fallbackIcon.className = 'fas fa-video';
                    fallbackTitle.textContent = 'Loading Naat Collection...';
                    fallbackMessage.textContent = message || 'Preparing your spiritual journey with beautiful Naats';
                    loadingSpinner.style.display = 'block';
                    retryBtn.style.display = 'none';
                    noCookieBtn.style.display = 'none';
                    externalBtn.style.display = 'none';
                    break;
                    
                case 'error':
                    fallbackIcon.className = 'fas fa-exclamation-triangle';
                    fallbackTitle.textContent = 'Unable to Load Player';
                    fallbackMessage.textContent = message || 'There was an issue loading the video player. Please try the options below.';
                    loadingSpinner.style.display = 'none';
                    retryBtn.style.display = 'inline-block';
                    noCookieBtn.style.display = 'inline-block';
                    externalBtn.style.display = 'inline-block';
                    break;
                    
                case 'retry':
                    fallbackIcon.className = 'fas fa-redo';
                    fallbackTitle.textContent = 'Retrying Connection...';
                    fallbackMessage.textContent = message || `Attempt ${playerAttempts} of ${maxAttempts}`;
                    loadingSpinner.style.display = 'block';
                    retryBtn.style.display = 'none';
                    noCookieBtn.style.display = 'none';
                    externalBtn.style.display = 'none';
                    break;
                    
                case 'csp-error':
                    fallbackIcon.className = 'fas fa-shield-alt';
                    fallbackTitle.textContent = 'Security Policy Restriction';
                    fallbackMessage.textContent = message || 'Content Security Policy is preventing video loading. Try privacy mode or open externally.';
                    loadingSpinner.style.display = 'none';
                    retryBtn.style.display = 'none';
                    noCookieBtn.style.display = 'inline-block';
                    externalBtn.style.display = 'inline-block';
                    break;
            }
        }
        
        // Enhanced YouTube API loading with multiple fallbacks
        function loadYouTubeAPI() {
            return new Promise((resolve, reject) => {
                // Check if YT API is already loaded
                if (window.YT && window.YT.Player) {
                    resolve();
                    return;
                }
                
                // Create script element for YouTube API
                const script = document.createElement('script');
                script.src = 'https://www.youtube.com/iframe_api';
                script.onerror = () => {
                    addStatusMessage('Failed to load YouTube API script', 'error');
                    reject(new Error('YouTube API script failed to load'));
                };
                
                // Set up the global callback
                window.onYouTubeIframeAPIReady = () => {
                    addStatusMessage('YouTube API loaded successfully');
                    resolve();
                };
                
                document.head.appendChild(script);
                
                // Timeout fallback
                setTimeout(() => {
                    if (!window.YT || !window.YT.Player) {
                        reject(new Error('YouTube API load timeout'));
                    }
                }, 10000);
            });
        }
        
        // Create iframe with enhanced CSP compliance
        function createYouTubeIframe() {
            const playerElement = document.getElementById('youtube-player');
            if (!playerElement) return;
            
            // Clear existing content
            playerElement.innerHTML = '';
            
            const iframe = document.createElement('iframe');
            const domain = useNoCookieVersion ? 'https://www.youtube-nocookie.com' : 'https://www.youtube.com';
            
            iframe.setAttribute('src', `${domain}/embed/videoseries?list=${currentPlaylistId}&autoplay=0&controls=1&rel=0&modestbranding=1&playsinline=1`);
            iframe.setAttribute('width', '100%');
            iframe.setAttribute('height', '100%');
            iframe.setAttribute('frameborder', '0');
            iframe.setAttribute('allowfullscreen', '');
            iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-presentation allow-forms');
            iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
            iframe.setAttribute('title', 'Naat Collection Playlist');
            
            // Add load event listeners
            iframe.onload = () => {
                addStatusMessage('Video player loaded successfully');
                playerReady = true;
                fallbackContainer.style.display = 'none';
            };
            
            iframe.onerror = () => {
                addStatusMessage('Iframe failed to load', 'error');
                handlePlayerError('iframe_load_error');
            };
            
            playerElement.appendChild(iframe);
        }
        
        // Initialize YouTube Player with API
        async function initializeYouTubePlayer() {
            try {
                playerAttempts++;
                updateFallbackUI('loading', `Initializing player (attempt ${playerAttempts}/${maxAttempts})`);
                
                await loadYouTubeAPI();
                
                const playerElement = document.getElementById('youtube-player');
                if (!playerElement) {
                    throw new Error('Player element not found');
                }
                
                // Clear fallback content
                const fallbackElement = playerElement.querySelector('.youtube-fallback');
                if (fallbackElement) {
                    fallbackElement.remove();
                }
                
                const domain = useNoCookieVersion ? 'https://www.youtube-nocookie.com' : 'https://www.youtube.com';
                
                youtubePlayer = new YT.Player(playerElement, {
                    height: "480",
                    width: "854",
                    host: domain,
                    playerVars: {
                        playsinline: 1,
                        listType: "playlist",
                        list: currentPlaylistId,
                        controls: 1,
                        rel: 0,
                        modestbranding: 1,
                        origin: window.location.origin
                    },
                    events: {
                        onReady: onPlayerReady,
                        onStateChange: onPlayerStateChange,
                        onError: onPlayerError
                    }
                });
                
                addStatusMessage('YouTube player initialized');
                
            } catch (error) {
                console.error('Player initialization failed:', error);
                handlePlayerError('initialization_failed', error.message);
            }
        }
        
        function onPlayerReady(event) {
            addStatusMessage('Player is ready to use');
            playerReady = true;
            fallbackContainer.style.display = 'none';
        }
        
        function onPlayerStateChange(event) {
            if (tvPlayButton) tvPlayButton.classList.toggle("hidden", event.data === YT.PlayerState.PLAYING);
            if (tvPauseButton) tvPauseButton.classList.toggle("hidden", event.data !== YT.PlayerState.PLAYING);
            
            // Add status updates based on player state
            switch(event.data) {
                case YT.PlayerState.PLAYING:
                    clearStatusMessages();
                    break;
                case YT.PlayerState.BUFFERING:
                    addStatusMessage('Buffering video...');
                    break;
                case YT.PlayerState.ENDED:
                    addStatusMessage('Naat completed. Playing next...');
                    break;
            }
        }
        
        function onPlayerError(event) {
            console.error("YouTube Player Error:", event.data);
            let errorMessage = 'Unknown error occurred';
            
            switch(event.data) {
                case 2:
                    errorMessage = 'Invalid video ID or playlist';
                    break;
                case 5:
                    errorMessage = 'HTML5 player error';
                    break;
                case 100:
                    errorMessage = 'Video not found or private';
                    break;
                case 101:
                case 150:
                    errorMessage = 'Video embedding disabled by owner';
                    break;
            }
            
            addStatusMessage(`Player Error (${event.data}): ${errorMessage}`, 'error');
            handlePlayerError('youtube_player_error', errorMessage);
        }
        
        function handlePlayerError(errorType, details = '') {
            console.error(`Player error: ${errorType}`, details);
            
            if (playerAttempts < maxAttempts) {
                updateFallbackUI('retry');
                setTimeout(() => {
                    if (errorType.includes('csp') || errorType.includes('security')) {
                        useNoCookieVersion = true;
                        updateFallbackUI('csp-error');
                    } else {
                        initializePlayer();
                    }
                }, 2000);
            } else {
                if (errorType.includes('csp') || errorType.includes('security')) {
                    updateFallbackUI('csp-error', details);
                } else {
                    updateFallbackUI('error', details);
                }
                fallbackContainer.style.display = 'flex';
            }
        }
        
        // Main player initialization function
        function initializePlayer() {
            if (playerAttempts >= maxAttempts) {
                updateFallbackUI('error', 'Maximum retry attempts reached');
                return;
            }
            
            // Try API method first, then fallback to iframe
            initializeYouTubePlayer().catch(() => {
                addStatusMessage('API method failed, trying direct iframe', 'error');
                createYouTubeIframe();
            });
        }
        
        // Control functions with error handling
        function playVideo() {
            try {
                if (youtubePlayer && youtubePlayer.playVideo) {
                    youtubePlayer.playVideo();
                } else {
                    addStatusMessage('Player not ready. Please wait or try reloading.', 'error');
                }
            } catch (error) {
                addStatusMessage('Error playing video: ' + error.message, 'error');
            }
        }
        
        function pauseVideo() {
            try {
                if (youtubePlayer && youtubePlayer.pauseVideo) {
                    youtubePlayer.pauseVideo();
                } else {
                    addStatusMessage('Player not ready', 'error');
                }
            } catch (error) {
                addStatusMessage('Error pausing video: ' + error.message, 'error');
            }
        }
        
        function nextVideo() {
            try {
                if (youtubePlayer && youtubePlayer.nextVideo) {
                    youtubePlayer.nextVideo();
                    addStatusMessage('Playing next Naat...');
                } else {
                    addStatusMessage('Player not ready', 'error');
                }
            } catch (error) {
                addStatusMessage('Error playing next video: ' + error.message, 'error');
            }
        }
        
        function previousVideo() {
            try {
                if (youtubePlayer && youtubePlayer.previousVideo) {
                    youtubePlayer.previousVideo();
                    addStatusMessage('Playing previous Naat...');
                } else {
                    addStatusMessage('Player not ready', 'error');
                }
            } catch (error) {
                addStatusMessage('Error playing previous video: ' + error.message, 'error');
            }
        }
        
        // Retry functions
        function retryPlayer() {
            playerAttempts = 0;
            clearStatusMessages();
            fallbackContainer.style.display = 'flex';
            updateFallbackUI('loading', 'Retrying player initialization...');
            initializePlayer();
        }
        
        function switchToNoCookie() {
            useNoCookieVersion = true;
            playerAttempts = 0;
            clearStatusMessages();
            addStatusMessage('Switching to privacy-friendly mode...');
            fallbackContainer.style.display = 'flex';
            updateFallbackUI('loading', 'Loading in privacy mode...');
            initializePlayer();
        }
        
        function openInNewTab() {
            const url = `https://www.youtube.com/playlist?list=${currentPlaylistId}`;
            window.open(url, '_blank');
            addStatusMessage('Opening YouTube in new tab...');
        }
        
        // Initial app setup and data fetching
        function initializeAppFast() {
            hideLoading();
            
            // Initialize player after a short delay
            setTimeout(() => {
                initializePlayer();
            }, 1000);
            
            async function fetchInitialData() { 
                await getUserLocation(); 
            }
            fetchInitialData();
        }

        function hideLoading() {
            loadingScreen.style.opacity = "0";
            setTimeout(() => {
                loadingScreen.style.display = "none";
                mainContent.style.opacity = 1;
            }, 300);
        }

        async function getUserLocation() {
            return new Promise(resolve => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(async position => {
                        try {
                            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${position.coords.latitude}&lon=${position.coords.longitude}`);
                            const data = await response.json();
                            if (islamicDateEl) {
                                getPrayerTimes(data.address.city || data.address.town, data.address.country);
                            }
                            if (locationEl) {
                                locationEl.textContent = `üìç ${data.address.city || data.address.town}, ${data.address.country}`;
                            }
                        } catch (error) {
                            console.error("Error fetching location or prayer times:", error);
                            if (locationEl) {
                                locationEl.textContent = "üìç Location unavailable";
                            }
                        }
                        resolve();
                    }, async () => {
                        console.warn("Geolocation permission denied or error.");
                        if (locationEl) {
                            locationEl.textContent = "üìç Location access denied";
                        }
                        resolve();
                    });
                } else {
                    console.warn("Geolocation not supported by this browser.");
                    if (locationEl) {
                        locationEl.textContent = "üìç Location not supported";
                    }
                    resolve();
                }
            });
        }

        async function getPrayerTimes(city, country) {
            try {
                const today = new Date();
                const dateString = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
                const apiUrl = `https://api.aladhan.com/v1/timingsByCity/${dateString}?city=${city}&country=${country}&method=2`;
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                if (data.code === 200 && islamicDateEl) {
                    const hijriDate = data.data.date.hijri;
                    islamicDateEl.textContent = `${hijriDate.weekday.en}, ${hijriDate.day} ${hijriDate.month.en} ${hijriDate.year} AH`;
                } else {
                    console.error("Failed to fetch prayer times:", data.status);
                    if (islamicDateEl) {
                        islamicDateEl.textContent = "Islamic date unavailable";
                    }
                }
            } catch (error) {
                console.error("Error fetching prayer times:", error);
                if (islamicDateEl) {
                    islamicDateEl.textContent = "Islamic date unavailable";
                }
            }
        }
        
        // Navigation Handler
        document.addEventListener("DOMContentLoaded", function() {
            // Initialize app
            initializeAppFast();
            
            // Set active navigation
            const navButtons = document.querySelectorAll('nav .nav-button');
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            navButtons.forEach(button => {
                const buttonPage = button.getAttribute('href');
                if (buttonPage === currentPage) {
                    button.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
